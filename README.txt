- AozoraEpub3  README -

=== About =====================================================================
青空文庫テキスト→ePub3変換
ver 1.0.6

=== Dependencies ==============================================================
Java 6 以上の動作環境 ( http://www.java.com/ja/ )

=== 使い方 ====================================================================
・インストール
  AozoraEpub3-1.0.6.zip を任意のフォルダに解凍します。

・起動
  AozoraEpub3.jar をダブルクリックして実行します。
  またはコンソールから "java -jar AozoraEpub3.jar" でも実行可。
  ※javaが見えなければフルパスで指定
    例: "C:\Program Files\Java\jre1.6.0_31\bin\java.exe" -jar AozoraEpub3.jar

・青空→ePub3変換
  表示されたアプレットに、変換したい青空文庫テキストファイル（拡張子txtまたはzip)
  （複数可）をドラッグ＆ドロップします。(「ファイル選択」から開くでも同じ)
  テキストファイルと同じ場所に「元ファイル名.epub」または「[著作者名] 表題.epub」
  のファイルが生成されます。


=== 使い方 CUI ================================================================
・コマンドラインからの実行 (仮)
Usage: java -cp AozoraEpub3.jar AozoraEpub3 "青空文庫テキスト1.txt" "青空文庫テキスト2.zip"

※現状オプション指定は未対応 (すべてアップレットのデフォルト状態)


=== 画面設定 ==================================================================
・表題行
 タイトルと著者名の有無を設定します。画像や空行は無視されます。
 ePubのtitleとcreatorに自動設定されます。
 chiki_tag.txtで指定したタグが設定されます。

・ファイル名に利用
 [著作者名] 表題.epub のファイル名で出力します。
 どちらも設定されていない場合は「元ファイル名.epub」で出力します。

・拡張子
 出力ファイルの拡張子を指定します。

・ePubファイル上書き
 同名のファイル(元ファイル名.epub)がすでにある場合でも上書きして出力します。

・半角2文字縦中横
 半角の2文字の数字、英字、!?を並べて縦書きにします。

・入力文字コード
 入力する青空文庫ファイルの文字コードを指定します。
 通常はMS932(SJIS)です。

=== ファイルの説明 ============================================================
・プログラムファイル
  AozoraEpub3.jar   	ePub3変換ツール
                    	ダブルクリックまたは"java -jar AozoraEpub3.jar"で実行
  lib/*.jar         	利用ライブラリ (compress, Velocity) +アイコン

・ePub3テンプレート
  template/*        	ePub3テンプレート
  template/OPS/css/*.css	ePub3スタイル

・変換用設定ファイル
  chuki_tag_suf.txt	前方参照型注記を開始終了型注記に変換
  chuki_tag.txt    	注記をePubタグに変換
  chuki_alt.txt    	外字注記を代替文字に変換
  chuki_utf.txt    	外字注記(コード無し)をUTF-8文字に変換
  chuki_latin.txt  	ラテン文字注記をUTF-8に変換

=== 対応している注記 ==========================================================
・基本的な注記に設定ファイルで対応
 chuki_tag.txt 参照
 
 例外的にプログラム処理しているもの
 ・字下げ連続時の［＃ここで字下げ終わり］の省略への対応
 ・複合字下げは数値化して計算［＃ここから○字下げ、折り返して●字下げ］
 
 ・画像 (キャプション、サイズ指定未対応)
 ［＃説明（ファイル名）］
 <img src="ファイル名"/>
 
=== 対応している外字と特殊文字 ================================================
 ・外字注記をUTF-8文字で出力 （UTF8コード、JISコードあり）
 ※［＃「さんずい＋垂」、unicode6DB6］
 ※［＃「さんずい＋垂」、U+6DB6、235-7］
 ※［＃「てへん＋劣」、第3水準1-84-77］
 
 ・UTF-8にない外字注記は代替文字を出力 (chuk_alt.txt)
 ・コード記述がない外字注記は名称からUTF-8に変換 (chuk_utf.txt JIS漢字は未登録)
 
 ・青空文庫特殊文字対応（《》［］〔〕｜＃※）
 ※［＃始め二重山括弧、1-1-52］ →《
 ※［＃終わり二重山括弧、1-1-53］ →》
 ※［＃始め角括弧、1-1-46］ →［
 ※［＃終わり角括弧、1-1-47］ →］
 ※［＃始めきっこう（亀甲）括弧、1-1-44］ →〔
 ※［＃終わりきっこう（亀甲）括弧、1-1-45］ →〕
 ※［＃縦線、1-1-35］ →｜
 ※［＃井げた、1-1-84］ →＃
 ※［＃米印、1-2-8］ →※
 
 ・くの字点「／＼」「／″＼」をUTF-8で出力

=== 未対応注記 ================================================================
 ・注記重複定義とルビ・圏点・縦横中を間に含む場合
 ・［＃ページの左右中央］の対応
 ・［＃ここから罫囲み］の対応
 ・［＃ここから横組み］の対応


=== Changes ===================================================================
[1.1] 予定
　- 指定数の空行後の指定パターンで改ページ (xhtmlファイル分割)
　- 大見出し直前で改ページがなけれは自動で改ページ (xhtmlファイル分割)

[1.0.6] - date: 2012/07/27
　- 表題指定を副題等にも対応
　- 表題著作者をファイル名から設定
　- ［＃ここから○字下げ、○字詰め］対応 
　- ［＃ここから○字下げ、罫囲み］対応 
　- 改ページ処理の改行を調整 　- kepub栞対応 (拡張子.kepub.epub時のみ)
　- 表紙ファイル指定 (ファイル選択,URL,先頭画像,なし)
　- 出力ファイルを setWritable(true)
　- コマンドラインからの実行に対応(仮) (引数 ファイル複数 オプション未対応)

[1.0.5u1] - date: 2012/07/24
　- 改ページの後ろの改行が次ページの先頭に出ていたのを修正
[1.0.5] - date: 2012/07/24
　- 注記対応 (字詰め、罫囲み、字下げ内の罫囲み)
　- タグを p から div に変更してスタイルも調整
　- 閉じていない［＃見出し］注記のタグエラー対策に必ず１行で閉じる (［＃見出し終わり］は無視)
　- 画像を含むzipファイルに対応
　- コマンドラインからの実行に対応(仮) (引数ファイル名1個のみ)

[1.0.4u1] - date: 2012/07/23
　- 小見出し注記でのタグ設定間違いのみchuki_tag.txt修正
[1.0.4] - date: 2012/07/22
　- 傍線スタイル調整
　- 縦書き横書き切り替え設定
　- 外字注記 UCS-コードに対応 (U+と同じ)

[1.0.3] - date: 2012/07/22
　- 縦中横、圏点スタイル調整 (-webkit -epub 記述追加)
　- 訓点が画像として扱われてしまったのを修正 (１文字なら訓点)
　- 拡張子を選択式に
　- Windowサイズを記憶
　- 圧縮率を調整 (画像は非圧縮)
　- nav.xhtml(仮)を出力

[1.0.2] - date: 2012/07/22
　- スタイルの width:100% 削除 
　- すべての画像にカバー画像指定が入っていたのを修正 (先頭のみ設定) 
　- 画像注記 ［＃（表紙.jpg）］ が読めていなかったのを修正 
　- Window位置を記憶

[1.0.1] - date: 2012/07/21
　- スタイルのフォント色と余白を調整
　- zip内のtxtファイル１つのみ変換に対応 (zip内画像、複数txtは未対応)
　- 出力ファイルの拡張子指定

[1.0] - date: 2012/07/21
　- AozoraXMDFの注記設定を変更してePub3対応版を作成
　- Zipアーカイブ形式でePub3ファイル一式を出力

=== TODO ======================================================================
・青空→ePub変換
　- 未対応注記の対応（左右中央など） 
　- 折り返し字下げ注記で2行目以降のインデントずれを修正 
　- 表紙画像設定 (properties="cover-image")
　- 画像サイズ、レイアウト最適化
　- Chapter名称抽出 (nav.xhtmlと目次ページ)
　- CSSのフォント指定 各機種向け調査?
　- 外字フォント対応?

・Applet
　- Zip読み込み(画像含む)
　- サブフォルダ再帰読み込み 
　- タイトルと著作者と表紙ファイル名(またはURL)を一旦表示して確認変更するオプション 
　- 先頭画像を表紙にするオプション 
　- 青空文庫用表紙画像生成
　- 複数ファイルをファイル名順で連結 (各Zip内txtすべて)

=== その他 ====================================================================
利用は自己責任でお願いします。
例外的な記述への対応はしていないので変換漏れ等があるかも。
ePubの仕様が自由なのと端末側ビューアも癖があるので汎用化は難しい気がする。
外字も余分に変換しているので、ビューアが対応していないと不具合でるかも。
バグや変換できない注記があった配布サイトで報告お願いします。